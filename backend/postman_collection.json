{
  "info": {
    "name": "SWDevTermProject - Reservation Flow",
    "_postman_id": "b8f2d5f0-0000-4000-8000-000000000000",
    "description": "Collection to run the end-to-end user/admin reservation flow via Newman",
    "schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
  },
  "variable": [
    { "key": "baseUrl", "value": "http://localhost:5004/api/v1", "type": "string" },
    { "key": "userEmail", "value": "user.newman@example.com" },
    { "key": "userPass", "value": "Password1!" },
    { "key": "adminEmail", "value": "admin.newman@example.com" },
    { "key": "adminPass", "value": "AdminPass1!" },
    { "key": "userToken", "value": "" },
    { "key": "adminToken", "value": "" },
    { "key": "userId", "value": "" },
    { "key": "restaurantId", "value": "" },
    { "key": "reservationId", "value": "" },
    { "key": "reviewReservationId", "value": "" },
    { "key": "adminReservationId", "value": "" },
    { "key": "reviewId", "value": "" }
  ],
  "item": [

    {
      "name": "1a - User Register",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"Test User\",\n  \"email\": \"{{userEmail}}\",\n  \"tel\": \"0812345678\",\n  \"password\": \"{{userPass}}\",\n  \"role\": \"user\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/auth/register",
          "protocol": "http",
          "host": ["localhost"],
          "port": "5004",
          "path": ["api","v1","auth","register"]
        }
      },
      "response": [],
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Register succeeded', function () {",
              "    pm.response.to.have.status(200);",
              "    var json = pm.response.json();",
              "    pm.expect(json.success).to.eql(true);",
              "    pm.environment.set('userToken', json.token);",
              "    pm.environment.set('userId', json._id);",
              "});"
            ]
          }
        }
      ]
    },
    {
      "name": "1b - User Register Duplicate Email",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": {
          "mode": "raw",
          "raw": "{\n  \"name\": \"Test User Dup\",\n  \"email\": \"{{userEmail}}\",\n  \"tel\": \"0812345678\",\n  \"password\": \"{{userPass}}\",\n  \"role\": \"user\"\n}"
        },
        "url": {
          "raw": "{{baseUrl}}/auth/register",
          "protocol": "http",
          "host": ["localhost"],
          "port": "5004",
          "path": ["api","v1","auth","register"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
                "pm.test('Duplicate user email returns 400', function () {",
                "    pm.response.to.have.status(400);",
                "    var json = pm.response.json();",
                "    pm.expect(json.success).to.eql(false);",
                "});"
            ]
          }
        }
      ]
    },
        {
      "name": "2a - Admin Register",
      "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" } ],
        "body": { "mode": "raw", "raw": "{\n  \"name\": \"Admin User\",\n  \"email\": \"{{adminEmail}}\",\n  \"tel\": \"0812345679\",\n  \"password\": \"{{adminPass}}\",\n  \"role\": \"admin\"\n}" },
        "url": {
          "raw": "{{baseUrl}}/auth/register",
          "protocol": "http",
          "host": ["localhost"],
          "port": "5004",
          "path": ["api","v1","auth","register"]
        }
      },
      "event": [ { "listen": "test", "script": { "exec": [
        "pm.test('Admin registered', function () {",
        "    pm.response.to.have.status(200);",
        "    var json = pm.response.json();",
        "    pm.expect(json.success).to.eql(true);",
        "});"
      ] } } ]
    },
    {
      "name": "2b - Admin Register Duplicate Email",
      "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" } ],
        "body": { "mode": "raw", "raw": "{\n  \"name\": \"Admin User Dup\",\n  \"email\": \"{{adminEmail}}\",\n  \"tel\": \"0812345679\",\n  \"password\": \"{{adminPass}}\",\n  \"role\": \"admin\"\n}" },
        "url": {
          "raw": "{{baseUrl}}/auth/register",
          "protocol": "http",
          "host": ["localhost"],
          "port": "5004",
          "path": ["api","v1","auth","register"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
                "pm.test('Duplicate admin email returns 400', function () {",
                "    pm.response.to.have.status(400);",
                "    var json = pm.response.json();",
                "    pm.expect(json.success).to.eql(false);",
                "});"
            ]
          }
        }
      ]
    },
    {
      "name": "3 - User Login",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" }
        ],
        "body": { "mode": "raw", "raw": "{\n  \"email\": \"{{userEmail}}\",\n  \"password\": \"{{userPass}}\"\n}" },
        "url": {
          "raw": "{{baseUrl}}/auth/login",
          "protocol": "http",
          "host": ["localhost"],
          "port": "5004",
          "path": ["api","v1","auth","login"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": { "exec": [
            "pm.test('Login succeeded', function () {",
            "    pm.response.to.have.status(200);",
            "    var json = pm.response.json();",
            "    pm.expect(json.success).to.eql(true);",
            "    pm.environment.set('userToken', json.token);",
            "    pm.environment.set('userId', json._id);",
            "});"
          ] }
        }
      ]
    },
    {
      "name": "4 - Browse Restaurants",
      "request": {
        "method": "GET",
        "header": [],
        "url": {
          "raw": "{{baseUrl}}/restaurants",
          "protocol": "http",
          "host": ["localhost"],
          "port": "5004",
          "path": ["api","v1","restaurants"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": {
            "exec": [
              "pm.test('Got restaurants', function () {",
              "    pm.response.to.have.status(200);",
              "    var json = pm.response.json();",
              "    pm.expect(json.success).to.eql(true);",
              "    pm.expect(json.count).to.be.above(0);",
              "    pm.environment.set('restaurantId', json.data[0]._id);",
              "});"
            ]
          }
        }
      ]
    },
    {
      "name": "5 - Create Reservation (valid)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Authorization", "value": "Bearer {{userToken}}" }
        ],
        "body": { "mode": "raw", "raw": "{\n  \"user\": \"{{userId}}\",\n  \"dateTime\": \"2025-11-22T12:00:00+07:00\"\n}" },
        "url": {
          "raw": "{{baseUrl}}/restaurants/{{restaurantId}}/reservations",
          "protocol": "http",
          "host": ["localhost"],
          "port": "5004",
          "path": ["api","v1","restaurants","{{restaurantId}}","reservations"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": { "exec": [
            "pm.test('Create reservation ok', function () {",
            "    pm.response.to.have.status(201);",
            "    var json = pm.response.json();",
            "    pm.expect(json.success).to.eql(true);",
            "    pm.environment.set('reservationId', json.data._id);",
            "});"
          ] }
        }
      ]
    },
    {
      "name": "6 - Create Reservation (bad - missing dateTime)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Authorization", "value": "Bearer {{userToken}}" }
        ],
        "body": { "mode": "raw", "raw": "{\n  \"user\": \"{{userId}}\"\n}" },
        "url": {
          "raw": "{{baseUrl}}/restaurants/{{restaurantId}}/reservations",
          "protocol": "http",
          "host": ["localhost"],
          "port": "5004",
          "path": ["api","v1","restaurants","{{restaurantId}}","reservations"]
        }
      },
      "event": [
        {
          "listen": "test",
          "script": { "exec": [
            "pm.test('Missing dateTime -> 400', function () {",
            "    pm.response.to.have.status(400);",
            "    var json = pm.response.json();",
            "    pm.expect(json.success).to.eql(false);",
            "    pm.expect(json.message).to.include('dateTime is required');",
            "});"
          ] }
        }
      ]
    },
    {
      "name": "7 - View My Reservation",
      "request": {
        "method": "GET",
        "header": [ { "key": "Authorization", "value": "Bearer {{userToken}}" } ],
        "url": {
          "raw": "{{baseUrl}}/reservations/{{reservationId}}",
          "protocol": "http",
          "host": ["localhost"],
          "port": "5004",
          "path": ["api","v1","reservations","{{reservationId}}"]
        }
      },
      "event": [ { "listen": "test", "script": { "exec": [
        "pm.test('Get reservation', function () {",
        "    pm.response.to.have.status(200);",
        "    var json = pm.response.json();",
        "    pm.expect(json.success).to.eql(true);",
        "    pm.expect(json.data._id).to.eql(pm.environment.get('reservationId'));",
        "});"
      ] } } ]
    },
    {
      "name": "8 - Edit My Reservation",
      "request": {
        "method": "PUT",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Authorization", "value": "Bearer {{userToken}}" }
        ],
        "body": { "mode": "raw", "raw": "{\n  \"user\": \"{{userId}}\",\n  \"dateTime\": \"2025-11-22T13:00:00+07:00\"\n}" },
        "url": {
          "raw": "{{baseUrl}}/reservations/{{reservationId}}",
          "protocol": "http",
          "host": ["localhost"],
          "port": "5004",
          "path": ["api","v1","reservations","{{reservationId}}"]
        }
      },
      "event": [ { "listen": "test", "script": { "exec": [
        "pm.test('Update reservation', function () {",
        "    pm.response.to.have.status(200);",
        "    var json = pm.response.json();",
        "    pm.expect(json.success).to.eql(true);",
        "});"
      ] } } ]
    },
    {
      "name": "9 - Delete My Reservation",
      "request": {
        "method": "DELETE",
        "header": [ { "key": "Authorization", "value": "Bearer {{userToken}}" } ],
        "url": {
          "raw": "{{baseUrl}}/reservations/{{reservationId}}",
          "protocol": "http",
          "host": ["localhost"],
          "port": "5004",
          "path": ["api","v1","reservations","{{reservationId}}"]
        }
      },
      "event": [ { "listen": "test", "script": { "exec": [
        "pm.test('Delete reservation', function () {",
        "    pm.response.to.have.status(200);",
        "    var json = pm.response.json();",
        "    pm.expect(json.success).to.eql(true);",
        "});"
      ] } } ]
    },
    {
      "name": "10 - User Logout",
      "request": {
        "method": "POST",
        "header": [ { "key": "Authorization", "value": "Bearer {{userToken}}" } ],
        "url": {
          "raw": "{{baseUrl}}/auth/logout",
          "protocol": "http",
          "host": ["localhost"],
          "port": "5004",
          "path": ["api","v1","auth","logout"]
        }
      },
      "event": [ { "listen": "test", "script": { "exec": [
        "pm.test('Logout ok', function () {",
        "    pm.response.to.have.status(200);",
        "    var json = pm.response.json();",
        "    pm.expect(json.success).to.eql(true);",
        "});"
      ] } } ]
    },
    {
      "name": "11 - Admin Login",
      "request": {
        "method": "POST",
        "header": [ { "key": "Content-Type", "value": "application/json" } ],
        "body": { "mode": "raw", "raw": "{\n  \"email\": \"{{adminEmail}}\",\n  \"password\": \"{{adminPass}}\"\n}" },
        "url": {
          "raw": "{{baseUrl}}/auth/login",
          "protocol": "http",
          "host": ["localhost"],
          "port": "5004",
          "path": ["api","v1","auth","login"]
        }
      },
      "event": [ { "listen": "test", "script": { "exec": [
        "pm.test('Admin login ok', function () {",
        "    pm.response.to.have.status(200);",
        "    var json = pm.response.json();",
        "    pm.expect(json.success).to.eql(true);",
        "    pm.environment.set('adminToken', json.token);",
        "});"
      ] } } ]
    },
    {
      "name": "12 - Admin Create Reservation (for user)",
      "request": {
        "method": "POST",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Authorization", "value": "Bearer {{adminToken}}" }
        ],
        "body": { "mode": "raw", "raw": "{\n  \"user\": \"{{userId}}\",\n  \"dateTime\": \"2025-11-23T12:00:00+07:00\"\n}" },
        "url": {
          "raw": "{{baseUrl}}/restaurants/{{restaurantId}}/reservations",
          "protocol": "http",
          "host": ["localhost"],
          "port": "5004",
          "path": ["api","v1","restaurants","{{restaurantId}}","reservations"]
        }
      },
      "event": [ { "listen": "test", "script": { "exec": [
        "pm.test('Admin created reservation', function () {",
        "    pm.response.to.have.status(201);",
        "    var json = pm.response.json();",
        "    pm.expect(json.success).to.eql(true);",
        "    pm.environment.set('adminReservationId', json.data._id);",
        "});"
      ] } } ]
    },
    {
      "name": "13 - Admin Update Reservation",
      "request": {
        "method": "PUT",
        "header": [
          { "key": "Content-Type", "value": "application/json" },
          { "key": "Authorization", "value": "Bearer {{adminToken}}" }
        ],
        "body": { "mode": "raw", "raw": "{\n  \"user\": \"{{userId}}\",\n  \"dateTime\": \"2025-11-23T13:00:00+07:00\"\n}" },
        "url": {
          "raw": "{{baseUrl}}/reservations/{{adminReservationId}}",
          "protocol": "http",
          "host": ["localhost"],
          "port": "5004",
          "path": ["api","v1","reservations","{{adminReservationId}}"]
        }
      },
      "event": [ { "listen": "test", "script": { "exec": [
        "pm.test('Admin updated reservation', function () {",
        "    pm.response.to.have.status(200);",
        "    var json = pm.response.json();",
        "    pm.expect(json.success).to.eql(true);",
        "});"
      ] } } ]
    },
    {
      "name": "14 - Admin Delete Reservation",
      "request": {
        "method": "DELETE",
        "header": [ { "key": "Authorization", "value": "Bearer {{adminToken}}" } ],
        "url": {
          "raw": "{{baseUrl}}/reservations/{{adminReservationId}}",
          "protocol": "http",
          "host": ["localhost"],
          "port": "5004",
          "path": ["api","v1","reservations","{{adminReservationId}}"]
        }
      },
      "event": [ { "listen": "test", "script": { "exec": [
        "pm.test('Admin deleted reservation', function () {",
        "    pm.response.to.have.status(200);",
        "    var json = pm.response.json();",
        "    pm.expect(json.success).to.eql(true);",
        "});"
      ] } } ]
    }
  ]
}
